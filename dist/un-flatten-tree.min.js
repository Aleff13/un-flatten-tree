!function(n){if("object"==typeof module&&"object"==typeof module.exports){var t=n(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports"],n)}(function(n,t){"use strict";function e(n,t,e,o){void 0===e&&(e=i),void 0===o&&(o=function(){});for(var r,u=n&&n.length?[{pointer:n,offset:0}]:[],f=[];u.length;)for(r=u.pop();r.offset<r.pointer.length;){var p=r.pointer[r.offset],c=o(p),d=t(p);f.push(e(p,r.node,c,r.nodeId)),r.offset+=1,d&&(u.push(r),r={pointer:d,offset:0,node:p,nodeId:c})}return f}function o(n,t,e,o){if(void 0===o)return u.call(n,function(o,r){var u=f(n,function(n){return t(r,n)});return void 0===u?o.push(r):e(r,u),o},[]);var i=r.call(n,function(n){return{in:n,out:o(n)}});return u.call(i,function(n,o){var r=f(i,function(n){return t(o.in,n.in)});return void 0===r?n.push(o.out):e(o.out,f(i,function(n){return n.in===r.in}).out),n},[])}var r=Array.prototype.map,u=Array.prototype.reduce,f=function(n,t){for(var e=n.length,o=0;o<e;o++)if(t(n[o]))return n[o]},i=function(n){return n};t.flatten=e,t.unflatten=o});