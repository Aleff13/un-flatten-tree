language: node_js

matrix:
  fast_finish: true
  include:
    - env: TEST='node'
      node_js:
        - '7'
        - '4'
    - env: TEST='browser'
      node_js: '4'
  allow_failures:
    - env: TEST='browser'

addons:
  sauce_connect:
    direct_domains: all 
    no_ssl_bump_domains: all
    tunnel_domains: localhost

branches:
  only:
    - master
    - /^v\d+\.\d+\.\d+$/

deploy:
  provider: npm
  email: iegoroff@gmail.com
  api_key:
    secure: >
      rgVtzou3HLvS3hkwL0e8ji8bYqesshnNkvslOKVxp61VUB2RKGni3SWKXbPRRxO9Cy+CelvNjkzzekQSHftI8dChuim4sj3Cobf/0bcDtvMUgYLF1
      EJS0UJ2cVrhTsdkerJO7/Ai5gK1Mh5TsfYaWI6+OfA4MOrHeBVeNcSKKqkEWJQ627tMa3BTZ9/kn2YCROR7siJFsprkhNo0ZkF9u6wOLAKzPDWNhG
      lAvqp7x+erWuOquhKvA1rCj1joyT8vLVN02u2zZbzfNrIsIveghBhvEAw7hVU1Urp3rJ2xVjRGA0co0uLH6tVfBlTiXmI/jDzqMrDpq6EnDuig1ML
      NIDZ6hXozOLnYSryvau5ZqeQky94X0TylextK9kIH+4Y4zpgocp+6x+iUG6mfalbHnqRPJGxIBzFQwEUBU96L9PPBOcfBv5yQ6VolHrU0Xtwch5EP
      nrn+Xwyi4VAMYFUjNhqi6ORcS/J/i+Ka+8DT/kr0IkqhdwW6AsrA80EmAdddYMQj/798uyar23VU4jAp0Kcuxf+xaaPHbrwVtVW3k77XfM8Ex3boM
      cm4xZF0wlOojUNejB9aF99CgSQLFXp9iNik3A6wnC09BBNIJ2VKWruhhHzvKqUhSDNp801cB9SU+RBAXBGavpQajZMSU6P9M2hpIJWQiL0TNSggF6
      DN2sY=
  on:
    tags: true
    condition: $TEST == 'node'


before_script:
  - npm run build

script:
  - if [[ $TEST == 'node' ]]; then npm run lint && npm run test:node; fi
  - if [[ $TEST == 'browser' ]]; then npm run test:browser; fi
after_script:
  - if [[ $TEST == 'node' ]]; then npm run coverage; fi
  
